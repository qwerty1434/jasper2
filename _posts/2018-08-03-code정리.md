
---
layout: post
current: post
cover: assets/images/bus.jpg
navigation: True
title: 작업코드정리
date: 2018-08-03 10:18:00
tags:
class: post-template
subclass: 'post'
author: qwerty1434
---



13,14,15,16,17 해양 데이터를 바탕으로 분석을 진행해야 하는데 국내 13,14,15년도 데이터가 부실한게 문제였다
팀원들과 모여서 얘기를 나누다 일본 데이터를 가져와 채워보는게 어떠냐는 의견이 나왔다

시간대별 데이터임에도 불구하고 일본은 데이터 정리가 잘되어있다는 생각이 들었다

같은 변수의 데이터였지만 당연히 일본과 국내간 차이가 있었고 처음 생각한대로 국내와일본 데이터가 모두 풍부한 16,17년도 데이터를 사용해 모델을 학습하고 모델로 13,14,15년도 국내 데이터를 예측하기로 했다 

정리하면 
TrainX = 16,17일본데이터
TrainY = 16,17국내데이터
TestX = 13,14,15일본데이터
TestY = 13,14,15국내데이터

일본데이터는 1~24시이고 
국내데이터는 0~23시까지인 차이
그래서 일본데이터의 2018년 1월 1일 24시 
국내데이터의 2018년 1월 2일 00시 에 해당한다
(파이썬 datetime에서도 24는 없더라)
그래서, 24를 00으로 바꿔주고
한 칸씩 밀어줘야 했다
24인 행만 바꿀까 생각해봤는데 24를 00으로 바꾸는것 뿐 아니라 날짜가 하나 더 올라가야 하기때문에 그냥 밀기로 했다
끄트머리가 하나씩 어긋나긴 하지만 데이터가 많아 신경쓰지 않았다(Train데이터만 해도 시간별로 2년의 데이터니깐 365*2*24)

코드를 살펴보자


{% highlight ruby %}
def jap_to_kor(data):
    data = data.fillna(method='ffill')    
{% endhighlight %}
fillna의 ffill method는
빈 칸을 앞의 값으로 채워준다
DataFrame([1,2,Nan,4]).fillna(method = 'ffill') 하면 [1,2,2,4]가 된다

{% highlight ruby %}
    dummy = ['dummy']
    a = pd.concat([DataFrame(dummy),data])['시']
    a = a.replace(float(24),0)
    b = pd.concat([data,DataFrame(dummy)])['일']
    b.index = a.index
    c = pd.concat([DataFrame(a),DataFrame(b)],axis = 1)
    c = c[1:]
{% endhighlight %}
시간 데이터는가장 앞에 더미를 덧붙이고 
일데이터는 맨 뒤를 덧붙인다
replace(float(24),0)을 통해 시간이 24인거는 0으로 바꿔준 후
그런 후 이들을 하나로 합치면 한칸 밀린 데이터가 완성된다~


이번 작업은 앞서 말씀드린대로 한칸씩 밀어주는 작업이다

{% highlight ruby %}    
    data['시'] = c['시']
    data['일'] = c['일']
    data['년'].iloc[-1] = data['년'].iloc[-1]+1
    data['월'].iloc[-1] = float(1)
    data['일'].iloc[-1] = float(1)
{% endhighlight %}
작업을 진행하면 마지막에는 년,월,일을 모두 바꿔줘야한다
그래서 마지막은 예외처리처럼 직접 선언해줬다

{% highlight ruby %}        
    li= [] 
    for i,_ in enumerate(data.index):
        e = datetime(int(data['년'][i]),
                         int(data['월'][i]),
                         int(data['일'][i]),
                         int(data['시'][i]))
        li.append(str(e))
{% endhighlight %}
이렇게 바꾼 시간데이터를 다시 합쳐주고 

{% highlight ruby %}        
        result = pd.concat([DataFrame(li),data['유의파고'],data['최대파고']],axis=1)
        result.columns = ['Date','유의파고', '최대파고']
        result = result.replace('X',float('Nan'))
    return result
{% endhighlight %}
변수 옆에다 붙여주면 끝~
원데이터에서 Na값이 빈칸이 아니고 X로 채워져 이었기 때문에 X를 Nan으로 바꿔주면 진짜 끝
